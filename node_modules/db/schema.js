/**
 * Created by mohammad on 7/5/15.
 */

var db = require('./index.js')

db.knex.schema.createTable('users', function (t) {
    t.increments();
    t.string('email', 128).unique();
    t.string('password', 255);
    t.string('name', 128);
    t.integer('created').unsigned();
    t.string('picture', 255);
}).createTable('documents', function (t) {
    t.increments();
    t.integer('user_id').unsigned().index().references('users.id');
    t.string('title', 255);
    t.integer('created').unsigned();
}).createTable('posts', function (t) {
    t.increments();
    t.integer('user_id').unsigned().index().references('users.id');
    t.integer('document_id').unsigned().index().references('documents.id');
    t.integer('updated').unsigned();
    t.integer('weight');
    t.text('body');
    t.index(['document_id', 'weight']);
    t.index(['user_id', 'updated']);
    t.unique(['user_id', 'document_id']);
}).then(function () {
    db.knex('users').insert({
        email: 'admin',
        password: '123456',
        name: 'محمد',
        created: Math.round(Date.now() / 1000)
    }).then(function () {
        console.log('End');
    })
});
